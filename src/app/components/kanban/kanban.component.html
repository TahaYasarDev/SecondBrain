<div
  [@fade]="isVisible ? 'visible' : 'hidden'"
  (@fade.done)="onFadeDone($event)"
>
  <div>
    <h1 contenteditable="true">Kanban</h1>
  </div>

  <div class="container">
    <div class="columns-wrapper">
      <div
        [@fade]="isVisible ? 'visible' : 'hidden'"
        class="column"
        *ngFor="let column of columns; let i = index"
      >
        <img
          src="assets/icons/delete-column.png"
          class="icon delete-column-btn"
          alt="delete-column"
          (click)="deleteColumn(i)"
        />
        <div class="column-header">
          <h2 contenteditable="true" (blur)="renameColumn($event, i)">
            {{ column.title }}
          </h2>
        </div>

        <div
          cdkDropList
          [cdkDropListData]="column.items"
          [cdkDropListConnectedTo]="getConnectedDropLists(i)"
          class="column-list"
          (cdkDropListDropped)="drop($event)"
          id="cdk-drop-list-{{ i }}"
        >
          <div
            *ngFor="
              let ticket of column.items;
              let j = index;
              trackBy: trackByFn
            "
            class="ticket-box"
            cdkDrag
            (dblclick)="openEditPopup(ticket)"
          >
            <p data-role="ticket-title">
              {{ ticket.title }}

              <img
                src="assets/icons/delete.png"
                alt="delete-task"
                class="icon delete-task-btn"
                (click)="deleteTask(i, j)"
              />
            </p>
            <p data-role="ticket-texte">{{ ticket.texte }}</p>
            <em data-role="ticket-estimate"
              >Estimate: {{ ticket.estimate }} days</em
            >
            <br />
            <em data-role="ticket-timeSpent"
              >Time spent: {{ ticket.timeSpent }} days</em
            >
            <br />
            <progress
              data-role="ticket-progress"
              [value]="ticket.progress"
              max="100"
            ></progress>
            <p data-role="ticket-jira">{{ ticket.jira }}</p>
          </div>

          <div class="add-ticket-btn" *ngIf="i === 0">
            <img
              class="icon"
              src="assets/icons/add.png"
              id="add-ticket-btn"
              alt="add-ticket-btn"
              (mouseenter)="startJumpAnimation()"
              (animationend)="onAnimationEnd()"
              [class.jump-animation]="isJumping"
              (click)="openEditPopup()"
            />
          </div>
        </div>
      </div>
    </div>

    <div class="add-column-btn">
      <img
        class="icon"
        src="assets/icons/add-column.png"
        id="add-column-btn"
        alt="add-column-btn"
        (mouseenter)="startJumpAnimationColumn()"
        (animationend)="onAnimationEnd()"
        [class.jump-animation]="isJumpingColumn"
        (click)="addColumn()"
      />
    </div>
  </div>

  <div
    [@fade]="isVisible ? 'visible' : 'hidden'"
    *ngIf="showPopup"
    class="popup-center"
  >
    <h3 id="popup-title">{{ editingItem ? "Edit Task" : "Create Task" }}</h3>

    <div class="form-row">
      <label>JIRA:</label>
      <input [(ngModel)]="popupItem.jira" placeholder="ABCD-12345" />
    </div>

    <div class="form-row">
      <label>Title:</label>
      <input [(ngModel)]="popupItem.title" placeholder="Side project" />
    </div>

    <div class="form-row">
      <label>Texte:</label>
      <textarea
        [(ngModel)]="popupItem.texte"
        placeholder="Create a kanban component with 4 columns."
      ></textarea>
    </div>

    <div class="form-row">
      <label>Estimate (days):</label>
      <input
        type="number"
        [(ngModel)]="popupItem.estimate"
        (keypress)="allowOnlyNumbers($event, 'estimate')"
        placeholder="0,5"
      />
      <p class="error-message" *ngIf="estimateError">
        Seuls les chiffres sont autorisés.
      </p>
    </div>

    <div class="form-row">
      <label>Time Spent (days):</label>
      <input
        type="number"
        [(ngModel)]="popupItem.timeSpent"
        (keypress)="allowOnlyNumbers($event, 'timeSpent')"
        placeholder="0,5"
      />
      <p class="error-message" *ngIf="timeSpentError">
        Seuls les chiffres sont autorisés.
      </p>
    </div>

    <div class="form-row">
      <label>Progress (%):</label>
      <input
        type="number"
        [(ngModel)]="popupItem.progress"
        min="0"
        max="100"
        (keypress)="allowOnlyNumbers($event, 'progress')"
        placeholder="0,5"
      />
      <p class="error-message" *ngIf="progressError">
        Seuls les chiffres sont autorisés.
      </p>
    </div>

    <div class="form-actions">
      <button (click)="savePopup()">Save</button>
      <button (click)="cancelPopup()">Cancel</button>
    </div>
  </div>
</div>
