<div
  [@fade]="isVisible ? 'visible' : 'hidden'"
  (@fade.done)="onFadeDone($event)"
>
  <div>
    <h1 contenteditable="true">{{ "kanban-title" | translate }}</h1>
  </div>

  <div class="container">
    <div class="columns-wrapper">
      <div
        [@fade]="isVisible ? 'visible' : 'hidden'"
        class="column"
        *ngFor="let column of columns; let i = index"
      >
        <img
          src="assets/icons/delete-column.png"
          class="icon delete-column-btn"
          alt="delete-column"
          (click)="deleteColumn(i)"
        />
        <div class="column-header">
          <h2 contenteditable="true" (blur)="renameColumn($event, i)">
            {{ column.title }}
          </h2>
        </div>

        <div
          cdkDropList
          [cdkDropListData]="column.items"
          [cdkDropListConnectedTo]="getConnectedDropLists(i)"
          class="column-list"
          (cdkDropListDropped)="drop($event)"
          id="cdk-drop-list-{{ i }}"
        >
          <div
            *ngFor="
              let ticket of column.items;
              let j = index;
              trackBy: trackByFn
            "
            class="ticket-box"
            cdkDrag
            (dblclick)="openEditPopup(ticket)"
          >
            <p data-role="ticket-title">
              {{ ticket.title }}

              <img
                src="assets/icons/delete.png"
                alt="delete-task"
                class="icon delete-task-btn"
                (click)="deleteTask(i, j)"
              />
            </p>
            <p data-role="ticket-texte">{{ ticket.texte }}</p>
            <em data-role="ticket-estimate"
              >{{ "kanban-ticket-label-estimated" | translate }}
              {{ ticket.estimate }} days</em
            >
            <br />
            <em data-role="ticket-timeSpent"
              >{{ "kanban-ticket-label-timeSpent" | translate }}
              {{ ticket.timeSpent }} days</em
            >
            <br />
            <progress
              class="custom-progress"
              data-role="ticket-progress"
              [value]="ticket.progress"
              max="100"
            ></progress>
            <p data-role="ticket-ticket">{{ ticket.ticket }}</p>
          </div>

          <div class="add-ticket-btn" *ngIf="i === 0">
            <img
              class="icon"
              src="assets/icons/add.png"
              id="add-ticket-btn"
              alt="add-ticket-btn"
              (mouseenter)="startJumpAnimation()"
              (animationend)="onAnimationEnd()"
              [class.jump-animation]="isJumping"
              (click)="openEditPopup()"
            />
          </div>
        </div>
      </div>
    </div>

    <div class="add-column-btn">
      <img
        class="icon"
        src="assets/icons/add-column.png"
        id="add-column-btn"
        alt="add-column-btn"
        (mouseenter)="startJumpAnimationColumn()"
        (animationend)="onAnimationEnd()"
        [class.jump-animation]="isJumpingColumn"
        (click)="addColumn()"
      />
    </div>
  </div>

  <div
    [@fade]="isVisible ? 'visible' : 'hidden'"
    *ngIf="showPopup"
    class="popup-center"
  >
    <h3 id="popup-title">
      {{
        editingItem
          ? ("kanban-ticket-modify-title" | translate)
          : ("kanban-ticket-create-title" | translate)
      }}
    </h3>

    <div class="form-row">
      <label>{{ "kanban-ticket-label-ticket" | translate }}</label>
      <input
        [(ngModel)]="popupItem.ticket"
        [attr.placeholder]="
          'kanban-ticket-label-ticket-placeholder' | translate
        "
      />
    </div>

    <div class="form-row">
      <label>{{ "kanban-ticket-label-title" | translate }}</label>
      <input
        [(ngModel)]="popupItem.title"
        [attr.placeholder]="'kanban-ticket-label-title-placeholder' | translate"
      />
    </div>

    <div class="form-row">
      <label>{{ "kanban-ticket-label-texte" | translate }}</label>
      <textarea
        [(ngModel)]="popupItem.texte"
        [attr.placeholder]="'kanban-ticket-label-texte-placeholder' | translate"
      ></textarea>
    </div>

    <div class="form-row">
      <label>{{ "kanban-ticket-label-estimated" | translate }}</label>
      <input
        type="number"
        [(ngModel)]="popupItem.estimate"
        (keypress)="allowOnlyNumbers($event, 'estimate')"
        [attr.placeholder]="
          'kanban-ticket-label-estimated-placeholder' | translate
        "
      />
      <p class="error-message" *ngIf="estimateError">
        {{ "kanban-error-label" | translate }}
      </p>
    </div>

    <div class="form-row">
      <label>{{ "kanban-ticket-label-timeSpent" | translate }}</label>
      <input
        type="number"
        [(ngModel)]="popupItem.timeSpent"
        (keypress)="allowOnlyNumbers($event, 'timeSpent')"
        [attr.placeholder]="
          'kanban-ticket-label-timeSpent-placeholder' | translate
        "
      />
      <p class="error-message" *ngIf="timeSpentError">
        {{ "kanban-error-label" | translate }}
      </p>
    </div>

    <div class="form-row">
      <label>{{ "kanban-ticket-label-progress" | translate }}</label>
      <input
        type="number"
        [(ngModel)]="popupItem.progress"
        min="0"
        max="100"
        (keypress)="allowOnlyNumbers($event, 'progress')"
        [attr.placeholder]="
          'kanban-ticket-label-progress-placeholder' | translate
        "
      />
      <p class="error-message" *ngIf="progressError">
        {{ "kanban-error-label" | translate }}
      </p>
    </div>

    <div class="form-actions">
      <button (click)="savePopup()">
        {{ "kanban-ticket-label-add-button" | translate }}
      </button>
      <button (click)="cancelPopup()">
        {{ "kanban-ticket-label-cancel-button" | translate }}
      </button>
    </div>
  </div>
</div>
